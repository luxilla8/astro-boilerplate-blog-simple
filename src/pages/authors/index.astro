---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Icon from '../../components/Icon.astro';

const authors = await getCollection('authors');
const allPosts = await getCollection('blog');
const publishedPosts = allPosts.filter((post) => !post.data.draft);

// Count posts per author
const postCounts = new Map<string, number>();
publishedPosts.forEach((post) => {
  const authorId = post.data.author || authors[0]?.id;
  if (authorId) {
    postCounts.set(authorId, (postCounts.get(authorId) || 0) + 1);
  }
});
---

<BaseLayout
  title="Authors"
  description="Meet the authors behind the blog."
>
  <!-- Header -->
  <div class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white py-20 md:py-28">
    <div class="max-w-6xl mx-auto px-6 md:px-8">
      <h1 class="text-4xl md:text-5xl font-bold mb-5">
        Authors
      </h1>
      <p class="text-xl text-gray-300 max-w-2xl leading-relaxed">
        Meet the people who write for this blog.
      </p>
    </div>
  </div>

  <div class="max-w-6xl mx-auto px-6 md:px-8 py-16 md:py-20">
    {authors.length === 0 ? (
      <div class="text-center py-20 bg-gray-50 dark:bg-gray-800 rounded-2xl">
        <div class="w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
          <Icon name="document" class="w-8 h-8 text-gray-400" />
        </div>
        <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">No authors yet</h2>
        <p class="text-gray-600 dark:text-gray-400 mb-6">Get started by creating your first author.</p>
        <a
          href="/keystatic"
          class="inline-flex items-center px-5 py-2.5 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 transition-colors"
        >
          Open Keystatic Admin
        </a>
      </div>
    ) : (
      <div class="grid gap-8 md:gap-10 md:grid-cols-2 lg:grid-cols-3">
        {authors.map((author) => {
          const count = postCounts.get(author.id) || 0;
          return (
            <a
              href={`/authors/${author.id}`}
              class="group block bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden hover:border-gray-300 dark:hover:border-gray-600 hover:shadow-lg transition-all duration-300 p-6"
            >
              <div class="flex items-start gap-4 mb-4">
                {author.data.avatar ? (
                  <img
                    src={author.data.avatar}
                    alt={author.data.name}
                    class="w-16 h-16 rounded-full object-cover flex-shrink-0"
                    loading="lazy"
                    decoding="async"
                  />
                ) : (
                  <div class="w-16 h-16 rounded-full bg-gradient-to-br from-primary-500 to-primary-700 flex items-center justify-center text-white font-semibold text-xl flex-shrink-0">
                    {author.data.name.charAt(0)}
                  </div>
                )}
                <div class="min-w-0">
                  <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">
                    {author.data.name}
                  </h2>
                  <p class="text-sm text-gray-500 dark:text-gray-400">
                    {count} {count === 1 ? 'post' : 'posts'}
                  </p>
                </div>
              </div>

              {author.data.bio && (
                <p class="text-gray-600 dark:text-gray-400 text-sm line-clamp-3 mb-4">
                  {author.data.bio}
                </p>
              )}

              <div class="flex items-center gap-3">
                {author.data.twitter && (
                  <span class="text-gray-400 dark:text-gray-500">
                    <Icon name="twitter" class="w-4 h-4" />
                  </span>
                )}
                {author.data.github && (
                  <span class="text-gray-400 dark:text-gray-500">
                    <Icon name="github" class="w-4 h-4" />
                  </span>
                )}
                {author.data.linkedin && (
                  <span class="text-gray-400 dark:text-gray-500">
                    <Icon name="linkedin" class="w-4 h-4" />
                  </span>
                )}
              </div>
            </a>
          );
        })}
      </div>
    )}
  </div>
</BaseLayout>
